<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAV to MP3 Conversion</title>
</head>

<body>
    <input type="file" id="inputFile" accept=".wav" />
    <button id="convertBtn">Convert to MP3</button>
    <audio id="audioPlayer" controls></audio>
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@latest"></script> <!-- 引入FFmpeg -->
    <script>
        document.getElementById('convertBtn').addEventListener('click', async () => {
            const fileInput = document.getElementById('inputFile');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a WAV file to convert.');
                return;
            }

            const reader = new FileReader();
            reader.onload = async function () {
                const inputData = new Uint8Array(reader.result);

                // 使用 FFmpeg 进行转换
                const mp3Blob = await ffmpegBuild(inputData);
                const mp3Url = URL.createObjectURL(mp3Blob);

                document.getElementById('audioPlayer').src = mp3Url; // 设置音频播放器源
            };

            reader.readAsArrayBuffer(file);
        });

        async function ffmpegBuild(inputData) {
            const { createFFmpeg } = FFmpegWASM; // 从加载的ffmpeg.js获取
            const ffmpeg = createFFmpeg({ log: true });

            await ffmpeg.load(); // 加载ffmpeg
            ffmpeg.FS('writeFile', 'input.wav', inputData); // 文件写入FFmpeg的虚拟文件系统

            await ffmpeg.run('-i', 'input.wav', 'output.mp3'); // 转换命令

            // 从虚拟文件系统中读取输出文件
            const data = ffmpeg.FS('readFile', 'output.mp3');

            // 返回MP3文件数据
            return new Blob([data.buffer], { type: 'audio/mp3' });
        }
    </script>
</body>

</html>